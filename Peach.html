<!DOCTYPE html>
<html lang="en">
<head>
  <title>Peach</title>
  <script src="http://cdn.jsdelivr.net/npm/phaser@3.19.0/dist/phaser.min.js"></script>
</head>
<body>
<script>

  var windowWidth = window.innerWidth - window.innerWidth*0.017;
  var windowHeight = window.innerHeight - window.innerHeight*0.015;

  const config = {
    type: Phaser.AUTO,
    width: windowWidth,
    height: windowHeight,
    transparent: true,
    scene: {
      preload: preload,
      create: create,
      update: update
    }
  };

  const game = new Phaser.Game(config);

  function preload()
  {
    this.load.image('planeSU57', 'Assets/SU-57.png');
    this.load.image('clouds', 'Assets/Cloud-Background.jpg');
    this.load.image('Platforms', 'Assets/Platforms.png');
    this.load.image('Akali', 'Assets/Akali.png');
  }

  function create()
  {
    this.add.image(400, 300, 'clouds').setScale(1);
    //plane  = this.add.image(400, 300, 'planeSU57').setScale(1);
    platform = this.add.image(400, 300, 'Platforms').setScale(platform_scale);
    akali = this.add.image(400, 300, 'Akali').setScale(akali_scale);

    //Platforms
    //platform.y = windowHeight + platform.y/2;
    onGroundPlatform = false;
    isJumpingCount = jump_height;
  }

  var plane;
  var akali;
  var player;
  var platform;
  var onGroundPlatform;
  var isJumpingCount;

  const platform_scale = 1;
  const akali_scale = 0.2;
  const player_scale = akali_scale;
  const walk_speed = 30;
  const jump_force = 12;
  const jump_height = 240;
  const gravity = 8;

  function update()
  {
    player = akali;
    var keyz = this.input.keyboard.addKey('z');
    var keys = this.input.keyboard.addKey('s');
    var keyq = this.input.keyboard.addKey('q');
    var keyd = this.input.keyboard.addKey('d');
    var keyRight = this.input.keyboard.addKey('RIGHT');
    var keySpace = this.input.keyboard.addKey('SPACE');

    //Gravity
    if(!isGrounded(player) && (!onGroundPlatform) && (isJumpingCount == jump_height))
    {
      player.y += gravity;
    }

    if(keyd.isDown && (player.x + (player.width*player_scale)/2) < windowWidth)
    {
      player.x += walk_speed;
    }
    if(keyq.isDown && (player.x - (player.width*player_scale)/2) > 0)
    {
      player.x -= walk_speed;
    }
    if(keyz.isDown && (player.y - (player.height*player_scale)/2) > 0)
    {
      //player.y -= walk_speed;
    }
    if(keys.isDown && (player.y + (player.height*player_scale)/2) < windowHeight)
    {
      //player.y += walk_speed;
    }

    if(checkHitbox(player,player_scale,platform,platform_scale))
    {
        while(checkHitbox(player,player_scale,platform,platform_scale))
        {
          player.y -= 1;
        }
        onGroundPlatform = true;
    }
    else
    {
      onGroundPlatform = false;
    }

    if(keySpace.isDown && (player.y - (player.height*player_scale)/2) > 0 && (isGrounded(player) || onGroundPlatform))
    {
      if(isJumpingCount == jump_height)
      {
        jump(jump_force);
      }
    }
    if(isJumpingCount != jump_height)
    {
      jump(jump_force);
    }
  }

  function checkHitbox(sprite1,sprite1_scale,sprite2,sprite2_scale)
  {
    return (((sprite1.y + ((sprite1.height*sprite1_scale)/2)) < (sprite2.y + ((sprite2.height*sprite2_scale)/2))) && (sprite1.y > (sprite2.y - ((sprite2.height*sprite2_scale)/2)))) && ((sprite1.x < (sprite2.x + ((sprite2.width*sprite2_scale)/2))) && (sprite1.x > (sprite2.x - ((sprite2.width*sprite2_scale)/2))));

  }

  function isGrounded(sprite)
  {
    return sprite.y >= windowHeight - (gravity+(player.height*player_scale)/2);
  }

  function jump(power)
  {
    if(isJumpingCount > 0)
    {
      player.y -= power;
      isJumpingCount -= power;
    }
    else
    {
      isJumpingCount = jump_height;
    }
  }

</script>
</body>
</html>
