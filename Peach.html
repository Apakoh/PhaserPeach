<!DOCTYPE html>
<html lang="en">
<head>
  <title>Peach</title>
  <script src="http://cdn.jsdelivr.net/npm/phaser@3.19.0/dist/phaser.min.js"></script>
</head>
<body>
<script>

  var windowWidth = window.innerWidth - window.innerWidth*0.017;
  var windowHeight = window.innerHeight - window.innerHeight*0.015;

  const config = {
    type: Phaser.AUTO,
    width: windowWidth,
    height: windowHeight,
    transparent: true,
    scene: {
      preload: preload,
      create: create,
      update: update
    }
  };

  const game = new Phaser.Game(config);

  function preload()
  {
    this.load.image('planeSU57', 'Assets/SU-57.png');
    this.load.image('clouds', 'Assets/Cloud-Background.jpg');
    this.load.image('Platforms', 'Assets/Platforms.png');
    this.load.image('Akali', 'Assets/Akali.png');
  }

  function create()
  {
    this.add.image(400, 300, 'clouds').setScale(1);
    //plane  = this.add.image(400, 300, 'planeSU57').setScale(1);
    platform = this.add.image(400, 300, 'Platforms').setScale(platform_scale);
    akali = this.add.image(400, 300, 'Akali').setScale(akali_scale);

    //Platforms
    //platform.y = windowHeight + platform.y/2;
    onGroundPlatform = false;
  }

  var plane;
  var akali;
  var player;
  var platform;
  var onGroundPlatform;

  const platform_scale = 1;
  const akali_scale = 0.2;
  const player_scale = akali_scale;
  const walk_speed = 10;
  const jump_force = 40;
  const gravity = 20;

  function update()
  {
    player = akali;
    var keyz = this.input.keyboard.addKey('z');
    var keys = this.input.keyboard.addKey('s');
    var keyq = this.input.keyboard.addKey('q');
    var keyd = this.input.keyboard.addKey('d');
    var keyRight = this.input.keyboard.addKey('RIGHT');
    var keySpace = this.input.keyboard.addKey('SPACE');

    //Gravity
    if((player.y < windowHeight - (gravity+(player.height*player_scale)/2)) && (!onGroundPlatform))
    {
      player.y += gravity;
    }

    if(keyd.isDown && (player.x + (player.width*player_scale)/2) < windowWidth)
    {
      player.x += walk_speed;
    }
    if(keyq.isDown && (player.x - (player.width*player_scale)/2) > 0)
    {
      player.x -= walk_speed;
    }
    if(keyz.isDown && (player.y - (player.height*player_scale)/2) > 0)
    {
      player.y -= walk_speed;
    }
    if(keys.isDown && (player.y + (player.height*player_scale)/2) < windowHeight)
    {
      player.y += walk_speed;
    }
    if(checkHitbox(player,player_scale,platform,platform_scale))
    {
        console.log("coucou");
        onGroundPlatform = true;
    }
    else
    {
      onGroundPlatform = false;
    }

    if(keySpace.isDown && (player.y - (player.height*player_scale)/2) > 0)
    {
      //console.log(player.y + (player.height*player_scale)/2);
      //console.log(windowHeight);
      for(i=0;i<jump_force;i++)
      {
        player.y -= 1;
      }
    }
  }

  function checkHitbox(sprite1,sprite1_scale,sprite2,sprite2_scale)
  {
    var result = false;
    if(((sprite1.y < (sprite2.y + ((sprite2.height*sprite2_scale)/2))) && (sprite1.y > (sprite2.y - ((sprite2.height*sprite2_scale)/2)))) && ((sprite1.x < (sprite2.x + ((sprite2.width*sprite2_scale)/2))) && (sprite1.x > (sprite2.x - ((sprite2.height*sprite2_scale)/2)))))
    {
      result = true;
    }
    return result;
  }

</script>
</body>
</html>
